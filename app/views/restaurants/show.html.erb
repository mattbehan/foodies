<%= javascript_include_tag "googlemaps" %>
<%= stylesheet_link_tag 'googlemaps' %>

<script src="https://maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap" async defer></script>
<!-- This is the map -->
<div id="map" class="col-xs-12"></div>
<!-- This is the directions form -->
<h1>Calculate your route</h1>
<form id="calculate-route" name="calculate-route" action="#" method="get">
  <label for="from">From address: </label>
  <input type="text" id="from" name="from" required="required" placeholder="An address" size="30" />
  or <a id="from-link" href="#">Get my position</a>
  <br />
  <input type="submit" />
</form>
<p id="error"></p>

<div class="container-fluid">
  <div class="row">

    <div class="col-xs-12">
      <h1 class="profile-header"><strong><%= @restaurant.name %></strong></h1>
    </div>

    <div class="col-xs-12">
      Foodie Score: <div class="restaurant-score btn"><strong><%= @restaurant.aggregate_score %></strong></div>
    </div>

    <div class="col-xs-12">
      <% if current_user && !current_user.already_quick_took?(@restaurant) %>
        <span class="rate-invitation">Been to <%= @restaurant.name %>?</span>
        <%= link_to "Rate it.", new_restaurant_quick_take_path(@restaurant), class: "quick-take-link", method: "get", remote: true %>
      <% elsif current_user && current_user.already_quick_took?(@restaurant) %>
        <% user_quick_take = QuickTake.find_by(rater_id: current_user.id, restaurant_id: @restaurant.id) %>
        <p>You gave this restaurant a <%= user_quick_take.rating %> on <%= user_quick_take.created_at.strftime("%m/%d/%y") %>.</p>
      <% end %>
      <div class="quick-take-form" style="display:none;">
      </div>
    </div>

    <div class="col-xs-12">
      <div class="user-interaction-buttons">
        <% if user_signed_in? && current_user.has_bookmarked?(@restaurant.id) %>
          <%= render partial: "bookmarks/unbookmark", locals: { restaurant: @restaurant }%>
        <% elsif user_signed_in? %>
          <%= render partial: "bookmarks/bookmark", locals: { restaurant: @restaurant }%>
        <% end %>

        <% if user_signed_in? && current_user.has_visited?(@restaurant.id) %>
          <%= render partial: "visits/visited", locals: { restaurant: @restaurant }%>
        <% elsif user_signed_in? %>
          <%= render partial: "visits/visit", locals: { restaurant: @restaurant }%>
        <% end %>
      </div>
    </div>

    <div class="col-xs-12">
      <p>Cuisine: <%= @restaurant.cuisine %><p>
    </div>

    <div class="col-xs-12">
      <p>Price range: <%= @restaurant.price_scale %>, Vegan friendliness: <%= @restaurant.vegan_friendliness %></p>
    </div>


      <ul style="list-style: none">
        <li>Address:
          <ul style="list-style: none">
            <li id="street-address"><%= @restaurant.street_address %></li>
            <li id="csz-address"><%= @restaurant.city %>, <%= @restaurant.state %> <%= @restaurant.zip %></li>
          </ul>
        </li>
        <li>Phone Number: <%= @restaurant.phone_number %></li>
        <li>Neighborhood: <%= @restaurant.neighborhood %></li>
        <li>Price Scale: <%= @restaurant.price_scale %></li>
      </ul>



      <% unless @restaurant.specialties.empty? %>
        <div class="specialties-container">
          <h4>Specialties</h4>
            <div class="top-specialties-list">
              <%= render partial: @specialties %>
            </div>

            <%= link_to "Show all specialties/add a dish", root_path, remote: true, :class => "btn btn-default specialties-toggle" %>

            <div id="rest-of-specialties" style="display:none"><%= render partial: "specialties/all_specialties", locals: {specialties: @rest_of_specialties} %> </div>
            <hr>
            <p><%= flash[:alert] %> </p>
            <!-- restaurant_specialties_path(@restaurant, @specialties) -->
            <%= render partial: "specialties/form", locals: {specialty: @new_specialty, restaurant: @restaurant} %>
            <hr>
        </div>
      <% end %>

      <% unless @reviews.empty? %>
        <h1>Reviews for <%= @restaurant.name %></h1>
        <hr>
        <%= render @reviews %>
      <% end %>


    </div>
    </div>
  </div>
</div>
